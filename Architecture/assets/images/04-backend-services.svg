<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 720" font-family="Segoe UI, Arial, sans-serif">
  <defs>
    <linearGradient id="hd4" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#1b5e20"/><stop offset="100%" stop-color="#2e7d32"/>
    </linearGradient>
    <filter id="s4" x="-4%" y="-4%" width="108%" height="108%">
      <feDropShadow dx="1" dy="2" stdDeviation="3" flood-opacity="0.12"/>
    </filter>
    <marker id="a4" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0,10 3.5,0 7" fill="#546e7a"/>
    </marker>
    <marker id="a4g" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0,10 3.5,0 7" fill="#2e7d32"/>
    </marker>
  </defs>

  <rect width="1100" height="720" rx="12" fill="#fafafa"/>
  <rect x="0" y="0" width="1100" height="56" rx="12" fill="url(#hd4)"/>
  <rect x="0" y="20" width="1100" height="36" fill="url(#hd4)"/>
  <text x="550" y="37" text-anchor="middle" fill="#fff" font-size="20" font-weight="700">Backend &amp; API Services â€” Architecture</text>

  <!-- ===== CLIENT ===== -->
  <rect x="420" y="75" width="260" height="50" rx="10" fill="#e3f2fd" stroke="#1e88e5" stroke-width="1.5" filter="url(#s4)"/>
  <text x="550" y="105" text-anchor="middle" fill="#0d47a1" font-size="14" font-weight="700">Next.js 15 â€” React SPA</text>

  <line x1="550" y1="125" x2="550" y2="155" stroke="#546e7a" stroke-width="1.5" marker-end="url(#a4)"/>
  <text x="560" y="145" fill="#78909c" font-size="9">HTTPS</text>

  <!-- ===== API GATEWAY ===== -->
  <rect x="330" y="160" width="440" height="75" rx="10" fill="#fff3e0" stroke="#fb8c00" stroke-width="1.5" filter="url(#s4)"/>
  <text x="550" y="185" text-anchor="middle" fill="#e65100" font-size="14" font-weight="700">Azure API Management â€” Gateway</text>
  <g fill="#37474f" font-size="10">
    <text x="350" y="210">ğŸ” JWT Validation (Entra ID)</text>
    <text x="550" y="210">â± Rate Limit: 60/min user</text>
    <text x="750" y="210">ğŸ’¾ Response Cache (15 min)</text>
  </g>

  <line x1="550" y1="235" x2="550" y2="270" stroke="#546e7a" stroke-width="1.5" marker-end="url(#a4)"/>

  <!-- ===== FASTAPI SERVICES ===== -->
  <rect x="40" y="275" width="1020" height="250" rx="12" fill="#e8f5e9" stroke="#43a047" stroke-width="2" filter="url(#s4)"/>
  <text x="550" y="300" text-anchor="middle" fill="#1b5e20" font-size="16" font-weight="700">FastAPI Microservices (AKS Pods â€” Python 3.12)</text>

  <!-- Auth Service -->
  <rect x="60" y="318" width="170" height="120" rx="8" fill="#fff" stroke="#66bb6a" stroke-width="1.5"/>
  <rect x="60" y="318" width="170" height="28" rx="8" fill="#a5d6a7"/>
  <text x="145" y="337" text-anchor="middle" fill="#1b5e20" font-size="12" font-weight="700">Auth Service</text>
  <g fill="#37474f" font-size="10">
    <text x="72" y="362">Token Validation</text>
    <text x="72" y="378">RBAC Enforcement</text>
    <text x="72" y="394">Session Management</text>
    <text x="72" y="414" fill="#78909c" font-size="9">python-jose Â· FastAPI</text>
  </g>

  <!-- Retrieval Service -->
  <rect x="250" y="318" width="170" height="120" rx="8" fill="#fff" stroke="#66bb6a" stroke-width="1.5"/>
  <rect x="250" y="318" width="170" height="28" rx="8" fill="#a5d6a7"/>
  <text x="335" y="337" text-anchor="middle" fill="#1b5e20" font-size="12" font-weight="700">Retrieval Service</text>
  <g fill="#37474f" font-size="10">
    <text x="262" y="362">Query Embedding</text>
    <text x="262" y="378">Hybrid Search</text>
    <text x="262" y="394">Re-ranking</text>
    <text x="262" y="414" fill="#78909c" font-size="9">azure-search-documents</text>
  </g>

  <!-- Orchestration Service -->
  <rect x="440" y="318" width="170" height="120" rx="8" fill="#fff" stroke="#66bb6a" stroke-width="1.5"/>
  <rect x="440" y="318" width="170" height="28" rx="8" fill="#a5d6a7"/>
  <text x="525" y="337" text-anchor="middle" fill="#1b5e20" font-size="12" font-weight="700">Orchestration Svc</text>
  <g fill="#37474f" font-size="10">
    <text x="452" y="362">Prompt Assembly</text>
    <text x="452" y="378">LLM Completion</text>
    <text x="452" y="394">Guardrails / Filters</text>
    <text x="452" y="414" fill="#78909c" font-size="9">openai SDK</text>
  </g>

  <!-- Reporting Service -->
  <rect x="630" y="318" width="170" height="120" rx="8" fill="#fff" stroke="#66bb6a" stroke-width="1.5"/>
  <rect x="630" y="318" width="170" height="28" rx="8" fill="#a5d6a7"/>
  <text x="715" y="337" text-anchor="middle" fill="#1b5e20" font-size="12" font-weight="700">Reporting Service</text>
  <g fill="#37474f" font-size="10">
    <text x="642" y="362">Metrics Aggregation</text>
    <text x="642" y="378">Data Export</text>
    <text x="642" y="394">Dashboard APIs</text>
    <text x="642" y="414" fill="#78909c" font-size="9">SQLAlchemy</text>
  </g>

  <!-- Ingestion Worker -->
  <rect x="820" y="318" width="220" height="120" rx="8" fill="#fff" stroke="#66bb6a" stroke-width="1.5"/>
  <rect x="820" y="318" width="220" height="28" rx="8" fill="#a5d6a7"/>
  <text x="930" y="337" text-anchor="middle" fill="#1b5e20" font-size="12" font-weight="700">Ingestion Worker (Async)</text>
  <g fill="#37474f" font-size="10">
    <text x="832" y="362">Document Parsing</text>
    <text x="832" y="378">Chunking (512 tok / 64 overlap)</text>
    <text x="832" y="394">Embedding &amp; Indexing</text>
    <text x="832" y="414" fill="#78909c" font-size="9">Celery Â· Service Bus trigger</text>
  </g>

  <!-- Route example -->
  <rect x="60" y="455" width="400" height="52" rx="6" fill="#f1f8e9" stroke="#aed581" stroke-width="1"/>
  <text x="70" y="475" fill="#33691e" font-size="10" font-weight="600">Example: POST /api/ask</text>
  <text x="70" y="492" fill="#546e7a" font-size="9">validate â†’ retrieve_chunks(query, filters, topK=5) â†’ generate_answer(query, chunks) â†’ AskResponse</text>

  <!-- ===== DOWNSTREAM: AI LAYER ===== -->
  <rect x="40" y="555" width="330" height="80" rx="10" fill="#fce4ec" stroke="#e53935" stroke-width="1.5" filter="url(#s4)"/>
  <text x="205" y="578" text-anchor="middle" fill="#b71c1c" font-size="13" font-weight="700">AI Layer</text>
  <text x="55" y="598" fill="#37474f" font-size="10">ğŸ§  Azure OpenAI (gpt-4.1 / 4o)</text>
  <text x="55" y="616" fill="#37474f" font-size="10">ğŸ” Azure AI Search (HNSW + BM25)</text>

  <!-- Arrows to AI -->
  <line x1="335" y1="525" x2="280" y2="555" stroke="#e53935" stroke-width="1.5" marker-end="url(#a4)"/>
  <line x1="525" y1="525" x2="320" y2="555" stroke="#e53935" stroke-width="1.5" marker-end="url(#a4)"/>

  <!-- ===== DOWNSTREAM: DATA ===== -->
  <rect x="400" y="555" width="330" height="80" rx="10" fill="#f3e5f5" stroke="#8e24aa" stroke-width="1.5" filter="url(#s4)"/>
  <text x="565" y="578" text-anchor="middle" fill="#4a148c" font-size="13" font-weight="700">Data Stores</text>
  <text x="415" y="598" fill="#37474f" font-size="10">ğŸ˜ PostgreSQL 16 (Azure Flexible)</text>
  <text x="415" y="616" fill="#37474f" font-size="10">ğŸ“¦ Azure Blob Storage (Hot tier)</text>

  <!-- Arrows to Data -->
  <line x1="550" y1="525" x2="550" y2="555" stroke="#8e24aa" stroke-width="1.5" marker-end="url(#a4)"/>
  <line x1="715" y1="525" x2="650" y2="555" stroke="#8e24aa" stroke-width="1.5" marker-end="url(#a4)"/>

  <!-- ===== DOWNSTREAM: ASYNC ===== -->
  <rect x="760" y="555" width="300" height="80" rx="10" fill="#e0f7fa" stroke="#00897b" stroke-width="1.5" filter="url(#s4)"/>
  <text x="910" y="578" text-anchor="middle" fill="#004d40" font-size="13" font-weight="700">Async Messaging</text>
  <text x="775" y="598" fill="#37474f" font-size="10">ğŸ“¨ Azure Service Bus (Standard)</text>
  <text x="775" y="616" fill="#37474f" font-size="10">Topics: doc-ingested Â· index-updated Â· report</text>

  <!-- Arrow to Async -->
  <line x1="930" y1="525" x2="920" y2="555" stroke="#00897b" stroke-width="1.5" marker-end="url(#a4)"/>

  <!-- ===== OBSERVABILITY BAR ===== -->
  <rect x="40" y="660" width="1020" height="40" rx="8" fill="#fff8e1" stroke="#f9a825" stroke-width="1.5"/>
  <text x="550" y="685" text-anchor="middle" fill="#e65100" font-size="12" font-weight="700">ğŸ“¡ Observability â€” OpenTelemetry SDK â†’ Azure Monitor / App Insights / Grafana  Â·  Correlation ID propagation</text>

  <text x="1080" y="714" text-anchor="end" fill="#b0bec5" font-size="9">QI Offerings â€” Backend Services v1.0</text>
</svg>
